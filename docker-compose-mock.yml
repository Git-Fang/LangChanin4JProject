# 使用Docker Compose Mock环境，忽略API密钥错误
# 该配置文件让应用可以启动并访问静态页面，但AI功能不可用
name: ragtranslation-mock

services:
  # 应用服务 - 使用Mock配置，禁用AI相关组件
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ragtranslation-app
    ports:
      - "8000:8000"
    environment:
      # 提供基础服务连接信息（如果您的数据库在容器中运行）
      SPRING_DATASOURCE_URL: jdbc:mysql://localhost:3306/guiguxiaozhi?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: root
      SPRING_DATA_MONGODB_URI: mongodb://localhost:27017/chat_db
      SPRING_REDIS_HOST: localhost
      SPRING_REDIS_PORT: 6379
      SPRING_RABBITMQ_HOST: localhost
      SPRING_RABBITMQ_PORT: 5672
      SPRING_RABBITMQ_USERNAME: admin
      SPRING_RABBITMQ_PASSWORD: admin
      AI_EMBEDDINGSTORE_QDRANT_HOST: localhost
      AI_EMBEDDINGSTORE_QDRANT_PORT: 6334

      # 提供API密钥但可接受测试值
      DeepSeek_API_KEY: ${DeepSeek_API_KEY:-test_key}
      KIMI_API_KEY: ${KIMI_API_KEY:-test_key}
      DASHSCOPE_API_KEY: ${DASHSCOPE_API_KEY:-sk-test-key}
      BAIDU_MAP_API_KEY: ${BAIDU_MAP_API_KEY:-test_key}

      # 使用简化配置，忽略AI模型错误
      spring.profiles.active: docker
      TERM: xterm
    command: >
      java
      -Dspring.profiles.active=docker
      -Dserver.port=8000
      -jar app.jar
      --spring.main.lazy-initialization=true
      --spring.autoconfigure.exclude=org.fb.config.LLMConfig
      --logging.level.org.fb.config=WARN
      --logging.level.dev.langchain4j=WARN
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    restart: unless-stopped

# 网络配置（如果需要）
networks:
  default:
    driver: bridge